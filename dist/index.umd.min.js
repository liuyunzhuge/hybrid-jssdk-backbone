!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).HybridJssdkBackbone=n()}(this,function(){"use strict";function O(e,n){return Object.prototype.toString.call(e)==="[object ".concat(n,"]")}function _(){}return function(e){var n=e.isNative,t=e.timeout,a=void 0===t?0:t,r=e.debug,o=void 0!==r&&r,i=e.logger,c=void 0===i?"hybrid-jssdk":i;function s(n){var e,t,r,o,i=(r=!(e=function(e){return n(e?w:null)}),function(){return r||(t=e.apply(this,arguments),r=!0),t});if(d())return k("bridge was ready"),i(d());if(!y){if(!a)return i(null);setTimeout(function(){k("wakeup timeout"),i(d())},a)}v?(o=i,k("wake up for android"),d()?o(d()):document.addEventListener("WebViewJavascriptBridgeReady",function(){o(d())},!1)):function(e){if(k("wake up for apple"),d())return e(d());if(window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var n=document.createElement("iframe");n.style.display="none",n.src="https://__bridge_loaded__",document.documentElement.appendChild(n),setTimeout(function(){document.documentElement.removeChild(n)},0)}(i)}function d(){return window.WebViewJavascriptBridge||null}function u(n,t){try{var e=JSON.parse(t);return O(e,"Object")?e:{message:t}}catch(e){return l("".concat(n," parse error:"),e),{message:t}}}function k(){if(o){for(var e,n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];(e=console).log.apply(e,["[".concat(c,"]")].concat(t))}}function l(){if(o){for(var e,n=arguments.length,t=Array(n),r=0;r<n;r++)t[r]=arguments[r];(e=console).error.apply(e,["[".concat(c,"]")].concat(t))}}var f=window.navigator.userAgent,v=!!f.match(/(Android);?[\s\/]+([\d.]+)?/),p=!!f.match(/\(Macintosh; Intel /),g=f.match(/(iPad).*OS\s([\d_]+)/),m=f.match(/(iPod)(.*OS\s([\d_]+))?/),h=!g&&f.match(/(iPhone\sOS)\s([\d_]+)/),b=!!(p||g||m||h),y=!!O(n,"Function")&&!!n(),w={},J=new Promise(function(e){return s(e)});return k("env settings:",{native:y,android:v,apple:b,timeout:a}),Object.assign(w,{ready:function(){return J},getBridge:d,toJson:function(e){try{return JSON.parse(e)}catch(e){return l(e),null}},invoke:function(e,n,t){var r=2<arguments.length&&void 0!==t?t:_;d()?d().callHandler(e,n,r):k("invoke invalid")},register:function(e,n,t){var r=2<arguments.length&&void 0!==t?t:_;d()?d().registerHandler(e,n,r):k("register invalid")},registerApi:function(e,n){var p,t,g,m,h,r=1<arguments.length&&void 0!==n?n:{},o=r.parseData,i=void 0===o?u:o,a=r.beforeInvoke,c=void 0===a?_:a,s=r.afterInvoke,d=void 0===s?_:s;return k("register api: ".concat(e)),this[e]=(p=e,g=(t={parseData:i,beforeInvoke:c,afterInvoke:d}).beforeInvoke,m=t.parseData,h=t.afterInvoke,function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];var r={},o={};1===n.length?(["success","fail","cancel","complete"].forEach(function(e){O(n[0][e],"Function")&&(o[e]=n[0][e],delete n[0][e])}),r=n[0]):n.length<2||(r=n[0],o=n[1]);var i=o.success,a=void 0===i?_:i,c=o.fail,s=void 0===c?_:c,d=o.complete,u=void 0===d?_:d,l=o.cancel,f=void 0===l?_:l,v=g(p,r)||r;k("invoke ".concat(p,", params:"),v),this.invoke(p,v,function(e){k("".concat(p," called, response:"),e);var n=m(p,e);n=h(p,n)||n,k("".concat(p," data after invoke:"),n);var t=n.message;if(k("".concat(p," message:"),n.message),t){var r=t.indexOf(":");switch(t.substring(1+r)){case"ok":a(n);break;case"cancel":f(n);break;default:s(n)}u(n)}})}),this[e]}}),w}});
