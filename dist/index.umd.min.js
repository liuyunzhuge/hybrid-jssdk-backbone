!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).HybridJssdkBackbone=n()}(this,function(){"use strict";function y(e,n){return Object.prototype.toString.call(e)==="[object ".concat(n,"]")}function O(){}return function(e){var n=e.isNative,t=e.timeout,r=void 0===t?0:t,i=e.debug,o=void 0!==i&&i,a=e.logger,c=void 0===a?"hybrid-jssdk":a,d=window.navigator.userAgent,s=!!d.match(/(Android);?[\s\/]+([\d.]+)?/),u=!!d.match(/\(Macintosh; Intel /),l=d.match(/(iPad).*OS\s([\d_]+)/),f=d.match(/(iPod)(.*OS\s([\d_]+))?/),v=!l&&d.match(/(iPhone\sOS)\s([\d_]+)/),p=!!(u||l||f||v),m=!!y(n,"Function")&&!!n(),g={};function h(n){var e,t,i,o,a=(i=!(e=function(e){return n(e?g:null)}),function(){return i||(t=e.apply(this,arguments),i=!0),t});if(b())return w("bridge was ready"),a(b());if(!m){if(!r)return a(null);setTimeout(function(){w("wakeup timeout"),a(b())},r)}s?(o=a,w("wake up for android"),b()?o(b()):document.addEventListener("WebViewJavascriptBridgeReady",function(){o(b())},!1)):function(e){if(w("wake up for apple"),b())return e(b());if(window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var n=document.createElement("iframe");n.style.display="none",n.src="https://__bridge_loaded__",document.documentElement.appendChild(n),setTimeout(function(){document.documentElement.removeChild(n)},0)}(a)}function b(){return window.WebViewJavascriptBridge||null}function k(n,t){try{var e=JSON.parse(t);return y(e,"Object")?e:{message:t}}catch(e){return function(){if(o){for(var e,n=arguments.length,t=Array(n),i=0;i<n;i++)t[i]=arguments[i];(e=console).error.apply(e,[c].concat(t))}}("".concat(n," parse error:"),e),{message:t}}}function w(){if(o){for(var e,n=arguments.length,t=Array(n),i=0;i<n;i++)t[i]=arguments[i];(e=console).log.apply(e,[c].concat(t))}}return w("env settings:",{native:m,android:s,apple:p,timeout:r}),Object.assign(g,{ready:function(){return new Promise(function(e){return h(e)})},invoke:function(e,n,t){var i=2<arguments.length&&void 0!==t?t:O;b()?b().callHandler(e,n,i):w("invoke invalid")},registerApi:function(l,e){var f=this,n=1<arguments.length&&void 0!==e?e:{},t=n.parseData,v=void 0===t?k:t,i=n.beforeInvoke,p=void 0===i?O:i,o=n.afterInvoke,m=void 0===o?O:o;w("register api: ".concat(l)),this[l]=function(){var e={},n={};1===arguments.length?n=0<arguments.length?arguments[0]:void 0:arguments.length<2||(e=0<arguments.length?arguments[0]:void 0,n=1<arguments.length?arguments[1]:void 0);var t=n.success,o=void 0===t?O:t,i=n.fail,a=void 0===i?O:i,r=n.complete,c=void 0===r?O:r,d=n.cancel,s=void 0===d?O:d,u=p(l,e)||e;w("invoke ".concat(l,", params:"),u),f.invoke(l,u,function(e){w("".concat(l," called, response:"),e);var n=v(l,e);n=m(l,n)||n,w("".concat(l," data after invoke:"),n);var t=n.message;if(w("".concat(l," message:"),n.message),t){var i=t.indexOf(":");switch(t.substring(1+i)){case"ok":o(n);break;case"cancel":s(n);break;default:a(n)}c(n)}})}}}),g}});
