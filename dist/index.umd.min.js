!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).HybridJssdkBackbone=n()}(this,function(){"use strict";function O(e,n){return Object.prototype.toString.call(e)==="[object ".concat(n,"]")}function _(){}return function(e){var n=e.isNative,t=e.timeout,i=void 0===t?1500:t,o=e.debug,r=void 0!==o&&o,a=e.logger,c=void 0===a?"hybrid-jssdk":a;function s(n){var e,t,o,r,a=(o=!(e=function(e){return n(e?w:null)}),function(){return o||(t=e.apply(this,arguments),o=!0),t});return d()?(k("bridge was ready"),a(d())):i?(setTimeout(function(){k("wakeup timeout"),a(d())},i),void(v?(r=a,k("wake up for android"),d()?r(d()):document.addEventListener("WebViewJavascriptBridgeReady",function(){r(d())},!1)):function(e){if(k("wake up for apple"),d())return e(d());if(window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var n=document.createElement("iframe");n.style.display="none",n.src="https://__bridge_loaded__",document.documentElement.appendChild(n),setTimeout(function(){document.documentElement.removeChild(n)},0)}(a))):a(null)}function d(){return window.WebViewJavascriptBridge||null}function u(n,t){try{var e=JSON.parse(t);return O(e,"Object")?e:{message:t}}catch(e){return l("".concat(n," parse error:"),e),{message:t}}}function k(){if(r){for(var e,n=arguments.length,t=Array(n),o=0;o<n;o++)t[o]=arguments[o];(e=console).log.apply(e,["[".concat(c,"]")].concat(t))}}function l(){if(r){for(var e,n=arguments.length,t=Array(n),o=0;o<n;o++)t[o]=arguments[o];(e=console).error.apply(e,["[".concat(c,"]")].concat(t))}}var f=window.navigator.userAgent,v=!!f.match(/(Android);?[\s\/]+([\d.]+)?/),p=!!f.match(/\(Macintosh; Intel /),g=f.match(/(iPad).*OS\s([\d_]+)/),m=f.match(/(iPod)(.*OS\s([\d_]+))?/),h=!g&&f.match(/(iPhone\sOS)\s([\d_]+)/),b=!!(p||g||m||h),y=!!O(n,"Function")&&!!n(),w={},J=new Promise(function(e){return s(e)});return k("env settings:",{native:y,android:v,apple:b,timeout:i}),Object.assign(w,{ready:function(){return J},getBridge:d,toJson:function(e){try{return JSON.parse(e)}catch(e){return l(e),null}},invoke:function(e,n,t){var o=2<arguments.length&&void 0!==t?t:_;d()?d().callHandler(e,n,o):k("invoke invalid")},register:function(e,n,t){var o=2<arguments.length&&void 0!==t?t:_;d()?d().registerHandler(e,n,o):k("register invalid")},registerApi:function(e,n){var p,t,g,m,h,o=1<arguments.length&&void 0!==n?n:{},r=o.parseData,a=void 0===r?u:r,i=o.beforeInvoke,c=void 0===i?_:i,s=o.afterInvoke,d=void 0===s?_:s;return k("register api: ".concat(e)),this[e]=(p=e,g=(t={parseData:a,beforeInvoke:c,afterInvoke:d}).beforeInvoke,m=t.parseData,h=t.afterInvoke,function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];var o={},r={};1===n.length?(["success","fail","cancel","complete"].forEach(function(e){O(n[0][e],"Function")&&(r[e]=n[0][e],delete n[0][e])}),o=n[0]):n.length<2||(o=n[0],r=n[1]);var a=r.success,i=void 0===a?_:a,c=r.fail,s=void 0===c?_:c,d=r.complete,u=void 0===d?_:d,l=r.cancel,f=void 0===l?_:l,v=g(p,o)||o;k("invoke ".concat(p,", params:"),v),this.invoke(p,v,function(e){k("".concat(p," called, response:"),e);var n=m(p,e);n=h(p,n)||n,k("".concat(p," data after invoke:"),n);var t=n.message;if(k("".concat(p," message:"),n.message),t){var o=t.indexOf(":");switch(t.substring(1+o)){case"ok":i(n);break;case"cancel":f(n);break;default:s(n)}u(n)}})}),this[e]}}),w}});
